<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hinter verschlossenen T√ºren - Vorlesen</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            line-height: 1.8;
            color: #2c1810;
            background: linear-gradient(135deg, #FFE5E5 0%, #FFB6C1 25%, #FF69B4 50%, #FFC0CB 75%, #FFCCCB 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #FFF8F0;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #C2185B, #8B1538);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .back-button-header {
            position: absolute;
            top: 15px;
            left: 15px;
        }

        .back-button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            text-decoration: none;
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            font-style: italic;
        }

        .controls {
            position: sticky;
            top: 20px;
            text-align: center;
            margin: 30px 0 10px 0;
            padding: 20px;
            background: linear-gradient(135deg, #FFF0F5 0%, #FFE4E6 100%);
            border-radius: 15px;
            border: 2px solid #C2185B;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(194, 24, 91, 0.3);
        }

        .language-navigation {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-lang {
            background: linear-gradient(135deg, #C2185B, #8B1538);
            color: white;
            border: 2px solid transparent;
        }

        .btn-lang.active {
            border-color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
        }

        .btn-lang:hover {
            background: linear-gradient(135deg, #8B1538, #AD1457);
            transform: translateY(-2px);
        }

        .btn-nav {
            background: linear-gradient(135deg, #4285f4, #1976d2);
            color: white;
            text-decoration: none;
            border: 2px solid transparent;
        }

        .btn-nav:hover {
            background: linear-gradient(135deg, #1976d2, #0d47a1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(66, 133, 244, 0.4);
        }

        .btn-read {
            background: linear-gradient(135deg, #32CD32, #228B22);
            color: white;
        }

        .btn-read:hover {
            background: linear-gradient(135deg, #228B22, #006400);
            transform: translateY(-2px);
        }

        .btn-stop {
            background: linear-gradient(135deg, #FF6347, #FF4500);
            color: white;
        }

        .btn-stop:hover {
            background: linear-gradient(135deg, #FF4500, #FF2400);
            transform: translateY(-2px);
        }

        .story-text {
            font-size: 1.1em;
            line-height: 1.8;
            color: #2F4F4F;
            text-align: justify;
            background: linear-gradient(135deg, #FFFAF0 0%, #FFF8DC 100%);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #DDA0DD;
            box-shadow: 0 5px 15px rgba(221,160,221,0.2);
            margin: 20px;
        }

        .story-text p {
            margin-bottom: 20px;
        }

        .hidden {
            display: none;
        }

        .status-message {
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            font-weight: bold;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .controls {
                padding: 15px;
            }

            .btn {
                display: block;
                margin: 10px auto;
                width: 200px;
            }

            .language-navigation {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }

            .story-text {
                padding: 20px;
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="back-button-header">
                <a href="die-verborgenen-kammern.html" class="back-button">‚Üê Zur√ºck zur Serie</a>
            </div>
            <h1 id="main-title">üåπ Hinter verschlossenen T√ºren</h1>
            <p id="author">von Helmut Wegner</p>
        </div>

        <div class="controls">
            <div class="language-navigation">
                <a href="index.html" class="btn btn-nav">üè† Startseite</a>
                <button class="btn btn-lang active" onclick="switchLanguage('de')">üá©üá™ Deutsch</button>
                <button class="btn btn-lang" onclick="switchLanguage('en')">üá¨üáß English</button>
                <button class="btn btn-lang" onclick="switchLanguage('es')">üá™üá∏ Espa√±ol</button>
                <a href="romantik-fiktion.html" class="btn btn-nav">üíï Romantik</a>
            </div>

            <div id="status-message" class="status-message" style="display: none;"></div>

            <button class="btn btn-read" onclick="startReading()">üîä <span id="btn-read-text">Vorlesen starten</span></button>
            <button class="btn btn-stop" onclick="stopReading()">‚èπÔ∏è <span id="btn-stop-text">Stoppen</span></button>
        </div>

        <!-- Deutsche Version -->
        <div id="de-content" class="language-content">
            <div class="story-text" id="storyText">
                <p>Elena Martinez stand vor dem imposanten schmiedeeisernen Tor der Villa Rosenberg und sp√ºrte, wie ihr Herz schneller schlug. Die gothische Architektur des 19. Jahrhunderts ragte vor ihr auf wie ein M√§rchenschloss aus einer anderen Zeit. Hohe Spitzbogenfenster reflektierten das goldene Licht der untergehenden Sonne, und verschn√∂rkelte Balkone warfen kunstvolle Schatten auf die Fassade aus r√∂tlichem Sandstein.</p>

                <p>Als junge Architektin hatte Elena schon viele historische Geb√§ude restauriert, aber diese Villa √ºbertraf alles, was sie bisher gesehen hatte. Sie war hierher gekommen, um die Renovierungsarbeiten zu √ºberwachen, die der neue Besitzer, ein geheimnisvoller Gesch√§ftsmann namens Victor Rosenberg, in Auftrag gegeben hatte. Doch je l√§nger sie das Geb√§ude betrachtete, desto mehr hatte sie das Gef√ºhl, dass diese Villa Geheimnisse barg, die weit √ºber ihre architektonische Sch√∂nheit hinausgingen.</p>

                <p>Ein k√ºhler Windhauch strich durch ihre langen, dunkelbraunen Haare und lie√ü sie fr√∂steln. Elena zog ihren Blazer enger um sich und dr√ºckte auf die Klingel neben dem Tor. Das tiefe, melodische L√§uten hallte durch die Stille und schien von den alten Mauern widerzuhallen, als w√ºrden sie selbst antworten.</p>

                <p>Nach wenigen Augenblicken √∂ffnete sich das Tor mit einem leisen Quietschen, und Elena betrat den gepflasterten Innenhof. Springbrunnen pl√§tscherten sanft in der Mitte des Hofes, umgeben von sorgf√§ltig gepflegten Rosenb√ºschen, deren Duft die Luft erf√ºllte. Die Kombination aus Architektur und Natur war atemberaubend.</p>

                <p>"Willkommen, Se√±orita Martinez." Eine tiefe, samtige Stimme lie√ü Elena herumfahren. Vor ihr stand ein Mann von beeindruckender Erscheinung. Victor Rosenberg war gro√ü und schlank, mit silbergrauem Haar, das perfekt zur√ºckgek√§mmt war, und durchdringenden blauen Augen, die sie zu durchschauen schienen. Er trug einen ma√ügeschneiderten dunkelgrauen Anzug, der seine elegante Gestalt betonte.</p>

                <p>"Herr Rosenberg," sagte Elena und streckte ihm die Hand entgegen. "Es ist mir eine Ehre, an der Restaurierung dieser wundersch√∂nen Villa arbeiten zu d√ºrfen." Seine Hand war warm und fest, und Elena sp√ºrte einen unerwarteten Schauer, als ihre Finger sich ber√ºhrten. Seine Augen verweilten einen Moment l√§nger auf ihrem Gesicht, als w√§re er auf der Suche nach etwas Bestimmtem.</p>

                <p>"Die Ehre ist ganz auf meiner Seite," erwiderte Victor mit einem L√§cheln, das sowohl charmant als auch geheimnisvoll war. "Ihre Reputation als Expertin f√ºr historische Architektur eilt Ihnen voraus. Ich bin √ºberzeugt, dass Sie genau die richtige Person sind, um den Geheimnissen dieser Villa auf den Grund zu gehen."</p>

                <p>Elena bemerkte die seltsame Formulierung, sagte aber nichts dazu. Stattdessen folgte sie Victor zur Haupteingangst√ºr, einer massiven Eichent√ºr mit kunstvollen Beschl√§gen aus poliertem Messing. "Die Villa wurde 1847 von meinem Urgro√üvater erbaut," erkl√§rte Victor, w√§hrend er die schwere T√ºr √∂ffnete. "Seither ist sie im Familienbesitz, wurde aber √ºber die Jahre vernachl√§ssigt. Es ist Zeit, ihr wieder zu alter Pracht zu verhelfen."</p>

                <p>Das Innere der Villa verschlug Elena den Atem. Eine geschwungene Marmortreppe f√ºhrte zu den oberen Stockwerken, w√§hrend hohe Stuckdecken und kristallene Kronleuchter den Eingangshall in warmes Licht tauchten. Doch trotz der offensichtlichen Pracht lag etwas Melancholisches in der Luft, als w√ºrde die Villa selbst um vergangene Zeiten trauern.</p>

                <p>"Ich m√∂chte Ihnen zun√§chst die wichtigsten R√§ume zeigen," sagte Victor und f√ºhrte sie durch einen langen Korridor. "Aber es gibt bestimmte Bereiche des Hauses, die ich vorerst als privat betrachte. Ich hoffe, Sie verstehen das." Elena nickte, obwohl sie eine merkw√ºrdige Neugier in sich aufsteigen sp√ºrte. Was verbarg Victor in diesen verbotenen R√§umen?</p>

                <p>Sie besichtigten den gro√üz√ºgigen Salon mit seinen antiken M√∂beln und wertvollen Gem√§lden, die Bibliothek mit deckenhohen B√ºcherregalen voller ledergebundener B√§nde, und den pr√§chtigen Speisesaal mit einem Tisch, der f√ºr zwanzig Personen gedeckt werden konnte. Jeder Raum erz√§hlte seine eigene Geschichte, und Elena konnte f√∂rmlich die Vergangenheit in den W√§nden sp√ºren.</p>

                <p>Als sie den Rundgang beendeten, standen sie wieder im Eingangshall. Victor betrachtete Elena mit einem nachdenklichen Ausdruck. "Es wird nicht einfach werden," sagte er leise. "Diese Villa hat viele Geheimnisse, und nicht alle davon sind angenehm. Sind Sie sicher, dass Sie bereit sind f√ºr das, was Sie hier entdecken k√∂nnten?"</p>

                <p>Elena blickte ihm direkt in die Augen. "Herr Rosenberg, ich bin Architektin, keine Schatzj√§gerin. Meine Aufgabe ist es, dieses wundersch√∂ne Geb√§ude zu restaurieren und zu bewahren. Was auch immer f√ºr Geheimnisse hier verborgen sind ‚Äì sie sind Teil der Geschichte dieses Ortes, und als solche verdienen sie Respekt."</p>

                <p>Ein L√§cheln umspielte Victors Lippen. "Sehr gut gesagt, Se√±orita Martinez. Ich denke, wir werden gut zusammenarbeiten." Er reichte ihr einen antiken Schl√ºssel. "Das ist Ihr Zugang zur Villa. Kommen Sie morgen fr√ºh, dann k√∂nnen wir mit der detaillierten Planung beginnen."</p>

                <p>Elena nahm den Schl√ºssel entgegen und sp√ºrte sein Gewicht in ihrer Hand. Das Metall war warm, als h√§tte es eine eigene Lebenskraft. "Bis morgen dann," sagte sie und wandte sich zum Gehen. Doch als sie das Tor erreichte und sich noch einmal umdrehte, war Victor bereits verschwunden, und die Villa lag still und geheimnisvoll im D√§mmerlicht.</p>

                <p>Auf dem Heimweg konnte Elena nicht aufh√∂ren, an Victor zu denken. Es war nicht nur seine beeindruckende Erscheinung oder sein Charme ‚Äì es war etwas Tieferes, Verborgenes, das sie faszinierte. Sie hatte das Gef√ºhl, dass ihr Leben sich durch diese Begegnung f√ºr immer ver√§ndert hatte, auch wenn sie noch nicht wusste, auf welche Weise.</p>

                <p>In dieser Nacht tr√§umte Elena von verschlossenen T√ºren und geheimnisvollen Korridoren, von leidenschaftlichen Blicken und verbotenen Ber√ºhrungen. Sie wachte mit dem Gef√ºhl auf, als st√ºnde sie am Beginn eines Abenteuers, das ihr Herz und ihre Seele f√ºr immer ver√§ndern w√ºrde.</p>
            </div>
        </div>

        <!-- Englische Version -->
        <div id="en-content" class="language-content hidden">
            <div class="story-text" id="storyTextEn">
                <p>Elena Martinez stood before the imposing wrought-iron gate of Villa Rosenberg and felt her heart beating faster. The Gothic 19th-century architecture towered before her like a fairy-tale castle from another time. High pointed arch windows reflected the golden light of the setting sun, and ornate balconies cast artistic shadows on the reddish sandstone facade.</p>

                <p>As a young architect, Elena had already restored many historic buildings, but this villa surpassed everything she had seen before. She had come here to oversee the renovation work commissioned by the new owner, a mysterious businessman named Victor Rosenberg. But the longer she looked at the building, the more she felt that this villa harbored secrets that went far beyond its architectural beauty.</p>

                <p>A cool breeze swept through her long, dark brown hair and made her shiver. Elena pulled her blazer tighter around herself and pressed the bell next to the gate. The deep, melodic chiming echoed through the silence and seemed to reverberate from the old walls, as if they themselves were answering.</p>

                <p>After a few moments, the gate opened with a soft squeak, and Elena entered the cobblestone courtyard. Fountains splashed gently in the center of the courtyard, surrounded by carefully tended rose bushes whose fragrance filled the air. The combination of architecture and nature was breathtaking.</p>

                <p>"Welcome, Se√±orita Martinez." A deep, velvety voice made Elena turn around. Before her stood a man of impressive appearance. Victor Rosenberg was tall and slim, with silver-gray hair perfectly combed back, and piercing blue eyes that seemed to see right through her. He wore a tailored dark gray suit that emphasized his elegant figure.</p>

                <p>"Mr. Rosenberg," Elena said, extending her hand to him. "It's an honor to work on the restoration of this beautiful villa." His hand was warm and firm, and Elena felt an unexpected shiver when their fingers touched. His eyes lingered a moment longer on her face, as if he were searching for something specific.</p>

                <p>"The honor is entirely mine," Victor replied with a smile that was both charming and mysterious. "Your reputation as an expert in historic architecture precedes you. I'm convinced that you're exactly the right person to get to the bottom of this villa's secrets."</p>

                <p>Elena noticed the strange phrasing but said nothing about it. Instead, she followed Victor to the main entrance door, a massive oak door with artistic brass fittings. "The villa was built in 1847 by my great-grandfather," Victor explained as he opened the heavy door. "It has been in the family ever since, but has been neglected over the years. It's time to restore it to its former glory."</p>

                <p>The interior of the villa took Elena's breath away. A curved marble staircase led to the upper floors, while high stucco ceilings and crystal chandeliers bathed the entrance hall in warm light. But despite the obvious splendor, there was something melancholic in the air, as if the villa itself was mourning for past times.</p>

                <p>"I'd like to show you the most important rooms first," Victor said, leading her through a long corridor. "But there are certain areas of the house that I consider private for now. I hope you understand that." Elena nodded, although she felt a strange curiosity rising within her. What was Victor hiding in these forbidden rooms?</p>

                <p>They toured the spacious salon with its antique furniture and valuable paintings, the library with its ceiling-high bookshelves full of leather-bound volumes, and the magnificent dining room with a table that could seat twenty people. Each room told its own story, and Elena could literally feel the past in the walls.</p>

                <p>When they finished the tour, they were back in the entrance hall. Victor looked at Elena with a thoughtful expression. "It won't be easy," he said quietly. "This villa has many secrets, and not all of them are pleasant. Are you sure you're ready for what you might discover here?"</p>

                <p>Elena looked directly into his eyes. "Mr. Rosenberg, I'm an architect, not a treasure hunter. My job is to restore and preserve this beautiful building. Whatever secrets are hidden here ‚Äì they are part of this place's history, and as such they deserve respect."</p>

                <p>A smile played around Victor's lips. "Very well said, Se√±orita Martinez. I think we'll work well together." He handed her an antique key. "This is your access to the villa. Come early tomorrow morning, then we can begin the detailed planning."</p>

                <p>Elena took the key and felt its weight in her hand. The metal was warm, as if it had a life force of its own. "Until tomorrow then," she said and turned to leave. But when she reached the gate and turned around once more, Victor had already disappeared, and the villa lay quiet and mysterious in the twilight.</p>

                <p>On the way home, Elena couldn't stop thinking about Victor. It wasn't just his impressive appearance or his charm ‚Äì it was something deeper, hidden, that fascinated her. She had the feeling that her life had been forever changed by this encounter, even though she didn't yet know in what way.</p>

                <p>That night Elena dreamed of locked doors and mysterious corridors, of passionate glances and forbidden touches. She woke up feeling as if she stood at the beginning of an adventure that would forever change her heart and soul.</p>
            </div>
        </div>

        <!-- Spanische Version -->
        <div id="es-content" class="language-content hidden">
            <div class="story-text" id="storyTextEs">
                <p>Elena Mart√≠nez se encontraba frente a la imponente puerta de hierro forjado de Villa Rosenberg y sinti√≥ c√≥mo su coraz√≥n lat√≠a m√°s r√°pido. La arquitectura g√≥tica del siglo XIX se alzaba ante ella como un castillo de cuento de hadas de otra √©poca. Las altas ventanas en arco apuntado reflejaban la luz dorada del sol poniente, y los balcones ornamentados proyectaban sombras art√≠sticas sobre la fachada de arenisca rojiza.</p>

                <p>Como joven arquitecta, Elena ya hab√≠a restaurado muchos edificios hist√≥ricos, pero esta villa superaba todo lo que hab√≠a visto antes. Hab√≠a venido aqu√≠ para supervisar los trabajos de renovaci√≥n encargados por el nuevo propietario, un misterioso empresario llamado V√≠ctor Rosenberg. Pero cuanto m√°s miraba el edificio, m√°s sent√≠a que esta villa albergaba secretos que iban mucho m√°s all√° de su belleza arquitect√≥nica.</p>

                <p>Una brisa fresca se desliz√≥ por su largo cabello casta√±o oscuro y la hizo temblar. Elena se ajust√≥ m√°s la chaqueta y presion√≥ el timbre junto a la puerta. El repique profundo y mel√≥dico reson√≥ a trav√©s del silencio y pareci√≥ rebotar en las viejas paredes, como si ellas mismas estuvieran respondiendo.</p>

                <p>Despu√©s de unos momentos, la puerta se abri√≥ con un suave chirrido, y Elena entr√≥ en el patio empedrado. Las fuentes salpicaban suavemente en el centro del patio, rodeadas de rosales cuidadosamente cuidados cuya fragancia llenaba el aire. La combinaci√≥n de arquitectura y naturaleza era impresionante.</p>

                <p>"Bienvenida, Se√±orita Mart√≠nez." Una voz profunda y aterciopelada hizo que Elena se diera la vuelta. Ante ella estaba un hombre de apariencia impresionante. V√≠ctor Rosenberg era alto y esbelto, con cabello gris plateado perfectamente peinado hacia atr√°s, y ojos azules penetrantes que parec√≠an ver a trav√©s de ella. Llevaba un traje gris oscuro hecho a medida que enfatizaba su figura elegante.</p>

                <p>"Se√±or Rosenberg," dijo Elena, extendi√©ndole la mano. "Es un honor trabajar en la restauraci√≥n de esta hermosa villa." Su mano era c√°lida y firme, y Elena sinti√≥ un escalofr√≠o inesperado cuando sus dedos se tocaron. Sus ojos se detuvieron un momento m√°s en su rostro, como si estuviera buscando algo espec√≠fico.</p>

                <p>"El honor es completamente m√≠o," respondi√≥ V√≠ctor con una sonrisa que era tanto encantadora como misteriosa. "Su reputaci√≥n como experta en arquitectura hist√≥rica la precede. Estoy convencido de que usted es exactamente la persona correcta para llegar al fondo de los secretos de esta villa."</p>

                <p>Elena not√≥ la extra√±a formulaci√≥n pero no dijo nada al respecto. En cambio, sigui√≥ a V√≠ctor hasta la puerta de entrada principal, una puerta masiva de roble con herrajes art√≠sticos de lat√≥n pulido. "La villa fue construida en 1847 por mi bisabuelo," explic√≥ V√≠ctor mientras abr√≠a la pesada puerta. "Ha estado en la familia desde entonces, pero ha sido descuidada a lo largo de los a√±os. Es hora de devolverle su antigua gloria."</p>

                <p>El interior de la villa le quit√≥ el aliento a Elena. Una escalera de m√°rmol curvada conduc√≠a a los pisos superiores, mientras que los techos altos de estuco y las l√°mparas de ara√±a de cristal ba√±aban el vest√≠bulo de entrada en luz c√°lida. Pero a pesar del esplendor obvio, hab√≠a algo melanc√≥lico en el aire, como si la propia villa estuviera de luto por tiempos pasados.</p>

                <p>Esta noche Elena so√±√≥ con puertas cerradas y corredores misteriosos, con miradas apasionadas y caricias prohibidas. Despert√≥ sintiendo como si estuviera al comienzo de una aventura que cambiar√≠a para siempre su coraz√≥n y su alma.</p>
            </div>
        </div>
    </div>

    <script>
        let currentSpeech = null;
        let isReading = false;
        let currentLanguage = 'de';
        let availableVoices = [];

        // Spracheinstellungen
        const languageTexts = {
            de: {
                title: "üåπ Hinter verschlossenen T√ºren",
                author: "von Helmut Wegner",
                btnRead: "Vorlesen starten",
                btnStop: "Stoppen",
                lang: "de-DE",
                startMessage: "Vorlesen gestartet! üîä",
                stopMessage: "Vorlesen gestoppt. ‚èπÔ∏è",
                errorMessage: "Fehler: Vorlesen wird von diesem Browser nicht unterst√ºtzt.",
                noVoiceMessage: "Hinweis: Keine deutsche Stimme verf√ºgbar. Verwende Standardstimme."
            },
            en: {
                title: "üåπ Behind Closed Doors",
                author: "by Helmut Wegner",
                btnRead: "Start Reading",
                btnStop: "Stop",
                lang: "en-US",
                startMessage: "Reading started! üîä",
                stopMessage: "Reading stopped. ‚èπÔ∏è",
                errorMessage: "Error: Text-to-speech not supported by this browser.",
                noVoiceMessage: "Note: No English voice available. Using default voice."
            },
            es: {
                title: "üåπ Detr√°s de Puertas Cerradas",
                author: "por Helmut Wegner",
                btnRead: "Comenzar Lectura",
                btnStop: "Parar",
                lang: "es-ES",
                startMessage: "¬°Lectura iniciada! üîä",
                stopMessage: "Lectura detenida. ‚èπÔ∏è",
                errorMessage: "Error: Text-to-speech no compatible con este navegador.",
                noVoiceMessage: "Nota: No hay voz en espa√±ol disponible. Usando voz predeterminada."
            }
        };

        function loadVoices() {
            return new Promise((resolve) => {
                availableVoices = speechSynthesis.getVoices();
                
                if (availableVoices.length > 0) {
                    resolve(availableVoices);
                } else {
                    // Fallback f√ºr Browser die Stimmen verz√∂gert laden
                    speechSynthesis.addEventListener('voiceschanged', function() {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, { once: true });
                    
                    // Timeout falls voiceschanged nicht feuert
                    setTimeout(() => {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, 1000);
                }
            });
        }

        function findBestVoice(targetLang) {
            if (availableVoices.length === 0) {
                return null;
            }

            // Suche nach perfekter √úbereinstimmung
            let voice = availableVoices.find(v => v.lang === targetLang);
            if (voice) return voice;

            // Suche nach Sprach-Familie (z.B. de f√ºr de-DE)
            const langFamily = targetLang.split('-')[0];
            voice = availableVoices.find(v => v.lang.startsWith(langFamily));
            if (voice) return voice;

            // Fallback: erste verf√ºgbare Stimme
            return availableVoices[0];
        }

        function switchLanguage(lang) {
            // Stoppe aktuelles Vorlesen
            stopReading();
            
            // Verstecke alle Sprachen
            document.querySelectorAll('.language-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Zeige ausgew√§hlte Sprache
            document.getElementById(lang + '-content').classList.remove('hidden');
            
            // Update Sprachbuttons
            document.querySelectorAll('.btn-lang').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update Texte
            currentLanguage = lang;
            const texts = languageTexts[lang];
            document.getElementById('main-title').textContent = texts.title;
            document.getElementById('author').textContent = texts.author;
            document.getElementById('btn-read-text').textContent = texts.btnRead;
            document.getElementById('btn-stop-text').textContent = texts.btnStop;
        }

        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${isError ? 'status-error' : 'status-success'}`;
            statusDiv.style.display = 'block';
            
            // Nachricht nach 5 Sekunden ausblenden
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        async function startReading() {
            // Pr√ºfe ob Browser Text-to-Speech unterst√ºtzt
            if (!('speechSynthesis' in window)) {
                showStatus(languageTexts[currentLanguage].errorMessage, true);
                return;
            }

            // Stoppe vorheriges Vorlesen
            stopReading();

            try {
                // Lade verf√ºgbare Stimmen
                await loadVoices();

                // Hole den Text der aktuellen Sprache
                const storyElement = document.querySelector(`#${currentLanguage}-content .story-text`);
                if (!storyElement) {
                    showStatus("Fehler: Text nicht gefunden.", true);
                    return;
                }

                // Teile Text in kleinere Abschnitte (bessere Kompatibilit√§t)
                const paragraphs = storyElement.querySelectorAll('p');
                if (paragraphs.length === 0) {
                    showStatus("Fehler: Keine Textabschnitte gefunden.", true);
                    return;
                }

                // Erstelle Text aus ersten 3 Abs√§tzen (f√ºr bessere Performance)
                let textToRead = '';
                for (let i = 0; i < Math.min(3, paragraphs.length); i++) {
                    textToRead += paragraphs[i].textContent + ' ';
                }

                if (textToRead.trim().length === 0) {
                    showStatus("Fehler: Kein Text zum Vorlesen gefunden.", true);
                    return;
                }

                // Erstelle neue Sprachausgabe
                currentSpeech = new SpeechSynthesisUtterance(textToRead.trim());
                
                // W√§hle beste verf√ºgbare Stimme
                const targetLang = languageTexts[currentLanguage].lang;
                const bestVoice = findBestVoice(targetLang);
                
                if (bestVoice) {
                    currentSpeech.voice = bestVoice;
                    currentSpeech.lang = bestVoice.lang;
                } else {
                    currentSpeech.lang = targetLang;
                    showStatus(languageTexts[currentLanguage].noVoiceMessage, false);
                }

                // Optimierte Einstellungen f√ºr bessere Kompatibilit√§t
                currentSpeech.rate = 0.8;  // Langsamer f√ºr bessere Verst√§ndlichkeit
                currentSpeech.volume = 1.0;
                currentSpeech.pitch = 1.0;

                // Event-Handler
                currentSpeech.onstart = function() {
                    isReading = true;
                    showStatus(languageTexts[currentLanguage].startMessage);
                };

                currentSpeech.onend = function() {
                    isReading = false;
                    currentSpeech = null;
                    showStatus("Vorlesen beendet. ‚úÖ");
                };

                currentSpeech.onerror = function(event) {
                    isReading = false;
                    currentSpeech = null;
                    console.error('Speech error:', event);
                    showStatus("Fehler beim Vorlesen. Browser-Problem erkannt.", true);
                };

                // Starte Vorlesen mit Fallback
                try {
                    speechSynthesis.speak(currentSpeech);
                    
                    // Zus√§tzliche Pr√ºfung nach 2 Sekunden
                    setTimeout(() => {
                        if (currentSpeech && !speechSynthesis.speaking && !speechSynthesis.pending) {
                            showStatus("Vorlesen konnte nicht gestartet werden. Browser-Einschr√§nkung.", true);
                            isReading = false;
                            currentSpeech = null;
                        }
                    }, 2000);
                    
                } catch (error) {
                    console.error('Speech synthesis error:', error);
                    showStatus("Fehler: " + error.message, true);
                    isReading = false;
                    currentSpeech = null;
                }

            } catch (error) {
                console.error('General error:', error);
                showStatus("Unerwarteter Fehler beim Vorlesen.", true);
                isReading = false;
                currentSpeech = null;
            }
        }

        function stopReading() {
            if (speechSynthesis.speaking || speechSynthesis.pending) {
                speechSynthesis.cancel();
            }
            
            if (currentSpeech) {
                currentSpeech = null;
            }
            
            if (isReading) {
                isReading = false;
                showStatus(languageTexts[currentLanguage].stopMessage);
            }
        }

        // Browser-Kompatibilit√§t pr√ºfen beim Laden
        document.addEventListener('DOMContentLoaded', async function() {
            if (!('speechSynthesis' in window)) {
                console.warn('Text-to-Speech wird von diesem Browser nicht unterst√ºtzt');
                showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                
                // Buttons deaktivieren
                const readBtn = document.querySelector('.btn-read');
                readBtn.style.opacity = '0.5';
                readBtn.style.cursor = 'not-allowed';
                readBtn.onclick = function() {
                    showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                };
            } else {
                // Lade Stimmen vorab
                try {
                    await loadVoices();
                    console.log('Verf√ºgbare Stimmen:', availableVoices.length);
                } catch (error) {
                    console.error('Fehler beim Laden der Stimmen:', error);
                }
            }
        });

        // Cleanup beim Verlassen der Seite
        window.addEventListener('beforeunload', function() {
            stopReading();
        });

        // Mobile Safari Fix
        document.addEventListener('touchstart', function() {
            if (!speechSynthesis.speaking && !speechSynthesis.pending) {
                // Dummy-Speech f√ºr Mobile Safari Aktivierung
                const dummySpeech = new SpeechSynthesisUtterance('');
                dummySpeech.volume = 0;
                speechSynthesis.speak(dummySpeech);
            }
        }, { once: true });
    </script>
</body>
</html>
